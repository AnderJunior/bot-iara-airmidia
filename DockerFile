# ---- build stage ----
    FROM node:22-alpine AS build
    WORKDIR /app
    
    COPY package*.json ./
    RUN npm ci
    
    COPY . .
    RUN npm run build
    
    # ---- runtime stage ----
    FROM node:22-alpine
    WORKDIR /app
    ENV NODE_ENV=production
    
    COPY --from=build /app/package*.json ./
    RUN npm ci --omit=dev
    
    COPY --from=build /app/build ./build
    COPY --from=build /app/constants.json ./constants.json
    
    # Ajuste se você tiver outros arquivos que o runtime precisa (ex.: templates, assets, etc.)
    
    # Porta do seu Fastify (você controla via SERVER_PORT)
    EXPOSE 3000
    
    CMD ["node", "."]    